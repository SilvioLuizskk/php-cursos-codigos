<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de Integra√ß√£o</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 40px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .result {
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .loading {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      button {
        padding: 12px 24px;
        margin: 8px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #0056b3;
      }
      .status {
        background: #e2e3e5;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .status ul {
        margin: 10px 0;
      }
      .status li {
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîó Teste de Integra√ß√£o Frontend ‚Üî Backend</h1>

      <div class="status">
        <h3>üìä Status dos Servi√ßos:</h3>
        <ul>
          <li>
            <strong>Frontend Vue.js:</strong>
            <span style="color: green">http://localhost:3000/ ‚úÖ Online</span>
          </li>
          <li>
            <strong>Backend Laravel:</strong>
            <span id="backend-status"
              >http://127.0.0.1:8001/api/ üîÑ Verificando...</span
            >
          </li>
        </ul>

        <h3>üõ†Ô∏è Configura√ß√µes:</h3>
        <ul>
          <li><strong>API Base URL:</strong> http://127.0.0.1:8001/api</li>
          <li><strong>CORS:</strong> Configurado para localhost:3000</li>
          <li><strong>Autentica√ß√£o:</strong> Laravel Sanctum</li>
        </ul>
      </div>

      <div>
        <h3>üß™ Testes de API:</h3>
        <button onclick="testProducts()">üõçÔ∏è Testar API de Produtos</button>
        <button onclick="testAuth()">üîê Testar API de Autentica√ß√£o</button>
        <button onclick="testFeatured()">‚≠ê Testar Produtos em Destaque</button>
        <button onclick="clearResults()">üóëÔ∏è Limpar Resultados</button>
      </div>

      <div id="results"></div>
    </div>

    <script>
      const API_BASE = "http://127.0.0.1:8001/api";

      function showResult(title, message, type = "success") {
        const results = document.getElementById("results");
        const div = document.createElement("div");
        div.className = `result ${type}`;
        div.innerHTML = `<strong>${title}:</strong> ${message}`;
        results.appendChild(div);
        results.scrollTop = results.scrollHeight;
      }

      function showLoading(title) {
        const results = document.getElementById("results");
        const div = document.createElement("div");
        div.className = "result loading";
        div.innerHTML = `<strong>${title}:</strong> üîÑ Carregando...`;
        div.id = "loading";
        results.appendChild(div);
      }

      function removeLoading() {
        const loading = document.getElementById("loading");
        if (loading) loading.remove();
      }

      function clearResults() {
        document.getElementById("results").innerHTML = "";
      }

      async function testBackendStatus() {
        try {
          const response = await fetch(`${API_BASE}/products`, {
            method: "GET",
            headers: { Accept: "application/json" },
          });

          const statusEl = document.getElementById("backend-status");
          if (response.ok || response.status === 404) {
            statusEl.innerHTML =
              '<span style="color: green;">http://127.0.0.1:8001/api/ ‚úÖ Online</span>';
          } else {
            statusEl.innerHTML =
              '<span style="color: orange;">http://127.0.0.1:8001/api/ ‚ö†Ô∏è Online (com erros)</span>';
          }
        } catch (error) {
          const statusEl = document.getElementById("backend-status");
          statusEl.innerHTML =
            '<span style="color: red;">http://127.0.0.1:8001/api/ ‚ùå Offline</span>';
        }
      }

      async function testProducts() {
        showLoading("Teste de Produtos");
        try {
          const response = await fetch(`${API_BASE}/products`, {
            method: "GET",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
          });

          removeLoading();

          if (response.ok) {
            const data = await response.json();
            const count = data.data ? data.data.length : 0;
            showResult(
              "API de Produtos",
              `‚úÖ Sucesso! Status: ${response.status}. Produtos encontrados: ${count}`,
              "success"
            );
          } else {
            const errorText = await response.text();
            showResult(
              "API de Produtos",
              `‚ùå Erro: ${response.status} - ${
                response.statusText
              }<br>Detalhes: ${errorText.substring(0, 200)}...`,
              "error"
            );
          }
        } catch (error) {
          removeLoading();
          showResult(
            "API de Produtos",
            `‚ùå Erro de conex√£o: ${error.message}<br>Verifique se o backend Laravel est√° rodando na porta 8001`,
            "error"
          );
        }
      }

      async function testAuth() {
        showLoading("Teste de Autentica√ß√£o");
        try {
          // Teste apenas se o endpoint existe (sem tentar criar usu√°rio)
          const response = await fetch(`${API_BASE}/auth/register`, {
            method: "POST",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
            body: JSON.stringify({}), // Dados vazios para for√ßar erro de valida√ß√£o
          });

          removeLoading();

          if (response.status === 422) {
            showResult(
              "API de Autentica√ß√£o",
              "‚úÖ Endpoint funcionando! Status: 422 (erro de valida√ß√£o esperado)",
              "success"
            );
          } else if (response.status === 201) {
            showResult(
              "API de Autentica√ß√£o",
              "‚úÖ Endpoint funcionando! Status: 201 (usu√°rio criado)",
              "success"
            );
          } else {
            const errorText = await response.text();
            showResult(
              "API de Autentica√ß√£o",
              `‚ö†Ô∏è Endpoint respondeu com status: ${
                response.status
              }<br>Detalhes: ${errorText.substring(0, 200)}...`,
              "error"
            );
          }
        } catch (error) {
          removeLoading();
          showResult(
            "API de Autentica√ß√£o",
            `‚ùå Erro de conex√£o: ${error.message}`,
            "error"
          );
        }
      }

      async function testFeatured() {
        showLoading("Teste de Produtos em Destaque");
        try {
          const response = await fetch(`${API_BASE}/products/featured`, {
            method: "GET",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },
          });

          removeLoading();

          if (response.ok) {
            const data = await response.json();
            const count = data.data ? data.data.length : 0;
            showResult(
              "Produtos em Destaque",
              `‚úÖ Sucesso! Status: ${response.status}. Produtos em destaque: ${count}`,
              "success"
            );
          } else {
            const errorText = await response.text();
            showResult(
              "Produtos em Destaque",
              `‚ùå Erro: ${response.status} - ${
                response.statusText
              }<br>Detalhes: ${errorText.substring(0, 200)}...`,
              "error"
            );
          }
        } catch (error) {
          removeLoading();
          showResult(
            "Produtos em Destaque",
            `‚ùå Erro de conex√£o: ${error.message}`,
            "error"
          );
        }
      }

      // Verificar status inicial
      window.onload = function () {
        showResult(
          "Sistema",
          "üöÄ P√°gina de teste carregada com sucesso!",
          "success"
        );
        testBackendStatus();

        // Executar teste inicial ap√≥s 1 segundo
        setTimeout(() => {
          testProducts();
        }, 1000);
      };
    </script>
  </body>
</html>
