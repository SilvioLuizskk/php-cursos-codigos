import{_ as e,j as a,d as o,p as s,q as t,s as l,c as r,o as n,a as i,b as c,t as u,u as d,v as m,x as p,F as g,g as v,y as b,z as y,A as f,B as h,n as k}from"./index-klLf_Ke9.js";import{a as w}from"./adminService-JkG_pKWo.js";import{u as x}from"./useImageUpload-DFF4QoUP.js";const P={class:"admin-products-page p-8"},_={key:0,class:"text-red-500"},C={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},j=["value"],q={class:"md:col-span-2"},A={class:"md:col-span-2"},E={class:"space-y-4"},I=["src"],U={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded"},z={key:1,class:"absolute inset-0 flex items-center justify-center bg-red-500 bg-opacity-75 rounded"},R=["onClick"],S=["disabled"],D={key:0},B={key:1},L={class:"w-full bg-white rounded shadow"},V={class:"p-2"},F=["src","alt"],N={key:1,class:"w-16 h-16 bg-gray-200 rounded flex items-center justify-center text-gray-500 text-xs"},M={class:"p-2"},$={class:"p-2"},T={class:"p-2"},G=["onClick"],O=["onClick"],H=e({__name:"AdminProducts",setup(e){const H=h(),{showNotification:J}=y(),{uploadImage:K}=x(),Q=a([]),W=a([]),X=a({name:"",price:0,description:"",category_id:"",stock_quantity:10,images:[]}),Y=a(null),Z=a(!1),ee=a(null),ae=o(()=>X.value.images.some(e=>"uploading"===e.status));async function oe(){var e;try{console.log("Buscando produtos..."),console.log("adminService disponível:",!!w),console.log("adminService.getAdminProducts:",typeof w.getAdminProducts);const e=await w.getAdminProducts();console.log("Produtos recebidos:",e),console.log("Tipo de data:",typeof e),console.log("data.data:",e.data),Q.value=e.data||e,console.log("Produtos atribuídos:",Q.value)}catch(a){console.error("Erro ao buscar produtos:",a),console.error("Detalhes do erro:",(null==(e=a.response)?void 0:e.data)||a.message),Q.value=[]}}async function se(){try{console.log("Buscando categorias...");const e=await w.getCategories();console.log("Categorias recebidas:",e),W.value=e.data||e}catch(e){console.error("Erro ao buscar categorias:",e),J("Erro ao carregar categorias","error")}}async function te(e){const a=Array.from(e.target.files);for(const s of a){const e={file:s,preview:URL.createObjectURL(s),status:"uploading",url:null};X.value.images.push(e);const a=X.value.images.length-1;try{console.log("Iniciando upload da imagem:",s.name);const e=K(s,"products"),o=new Promise((e,a)=>setTimeout(()=>a(new Error("Upload timeout")),3e4)),t=await Promise.race([e,o]);if(t){console.log("Upload concluído com sucesso:",t);const e={...X.value.images[a],status:"success",url:t};X.value.images.splice(a,1,e),await f()}else{console.error("Upload falhou - resultado vazio");const e={...X.value.images[a],status:"error"};X.value.images.splice(a,1,e),await f()}}catch(o){console.error("Erro no upload da imagem:",s.name,o);const e={...X.value.images[a],status:"error"};X.value.images.splice(a,1,e),await f(),J(`Erro ao fazer upload da imagem ${s.name}`,"error")}}e.target.value=""}function le(e){e.target.src="/placeholder-image.png"}async function re(){if(ae.value)J("Aguarde o upload das imagens terminar","warning");else{Z.value=!0;try{const e=X.value.images.filter(e=>"success"===e.status).map(e=>e.url);console.log("Imagens filtradas:",e);const a={name:X.value.name,price:parseFloat(X.value.price)||0,description:X.value.description,category_id:parseInt(X.value.category_id),stock:parseInt(X.value.stock_quantity)||0,sku:X.value.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")+"-"+Date.now(),status:"active",images:e};console.log("Dados do produto a serem enviados:",a),Y.value?(console.log("Atualizando produto ID:",Y.value),await w.updateProduct(Y.value,a),J("Produto atualizado com sucesso!","success"),Y.value=null):(console.log("Criando novo produto"),await w.createProduct(a),J("Produto criado com sucesso!","success")),await oe(),X.value={name:"",price:0,description:"",category_id:"",stock_quantity:10,images:[]}}catch(e){console.error("Erro ao salvar produto:",e),J("Erro ao salvar produto","error")}finally{Z.value=!1}}}return s(()=>{console.log("AdminProducts mounted"),oe(),se()}),t(()=>H.path,(e,a)=>{e!==a&&(console.log("Rota mudou, recarregando dados"),oe(),se())}),l(()=>{console.log("AdminProducts unmounting, limpando estado"),Q.value=[],W.value=[],X.value={name:"",price:0,description:"",category_id:"",stock_quantity:10,images:[]},Y.value=null,Z.value=!1}),(e,a)=>(n(),r("div",P,[a[18]||(a[18]=i("h1",{class:"text-2xl font-bold mb-6"},"Administração de Produtos",-1)),i("p",null,"Debug: Componente carregado. Produtos: "+u(Q.value.length),1),i("p",null,"Debug: Categorias: "+u(W.value.length),1),0===Q.value.length?(n(),r("p",_," Nenhum produto encontrado. Verifique a API. ")):c("",!0),i("form",{onSubmit:b(re,["prevent"]),class:"mb-8 bg-white p-6 rounded shadow"},[i("div",C,[i("div",null,[a[6]||(a[6]=i("label",{class:"block font-semibold mb-1"},"Nome do Produto",-1)),d(i("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>X.value.name=e),class:"input",required:""},null,512),[[m,X.value.name]])]),i("div",null,[a[7]||(a[7]=i("label",{class:"block font-semibold mb-1"},"Preço (R$)",-1)),d(i("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>X.value.price=e),type:"number",min:"0",step:"0.01",class:"input",required:""},null,512),[[m,X.value.price,void 0,{number:!0}]])]),i("div",null,[a[9]||(a[9]=i("label",{class:"block font-semibold mb-1"},"Categoria",-1)),d(i("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>X.value.category_id=e),class:"input",required:""},[a[8]||(a[8]=i("option",{value:""},"Selecione uma categoria",-1)),(n(!0),r(g,null,v(W.value,e=>(n(),r("option",{key:e.id,value:e.id},u(e.name),9,j))),128))],512),[[p,X.value.category_id]])]),i("div",null,[a[10]||(a[10]=i("label",{class:"block font-semibold mb-1"},"Estoque",-1)),d(i("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>X.value.stock_quantity=e),type:"number",min:"0",class:"input",required:""},null,512),[[m,X.value.stock_quantity,void 0,{number:!0}]])]),i("div",q,[a[11]||(a[11]=i("label",{class:"block font-semibold mb-1"},"Descrição",-1)),d(i("textarea",{"onUpdate:modelValue":a[4]||(a[4]=e=>X.value.description=e),class:"input",rows:"2"},null,512),[[m,X.value.description]])]),i("div",A,[a[15]||(a[15]=i("label",{class:"block font-semibold mb-1"},"Imagens",-1)),i("div",E,[(n(!0),r(g,null,v(X.value.images,(e,o)=>(n(),r("div",{key:o,class:"relative inline-block mr-4 mb-4"},[i("img",{src:e.preview||e.url,class:k(["w-24 h-24 object-cover rounded border",{"border-green-500":"success"===e.status,"border-red-500":"error"===e.status,"border-blue-500":"uploading"===e.status}])},null,10,I),"uploading"===e.status?(n(),r("div",U,[...a[12]||(a[12]=[i("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"},null,-1)])])):c("",!0),"error"===e.status?(n(),r("div",z,[...a[13]||(a[13]=[i("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):c("",!0),i("button",{onClick:e=>function(e){const a=X.value.images[e];a&&a.preview&&URL.revokeObjectURL(a.preview),X.value.images.splice(e,1)}(o),class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition",title:"Remover imagem"}," × ",8,R)]))),128)),i("div",{onClick:a[5]||(a[5]=a=>e.$refs.fileInput.click()),class:"w-24 h-24 border-2 border-dashed border-gray-300 rounded flex items-center justify-center cursor-pointer hover:border-gray-400 transition"},[...a[14]||(a[14]=[i("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)])]),i("input",{ref_key:"fileInput",ref:ee,type:"file",multiple:"",accept:"image/*",onChange:te,class:"hidden"},null,544)]),a[16]||(a[16]=i("p",{class:"text-sm text-gray-500 mt-2"}," PNG, JPG até 5MB cada ",-1))])]),i("button",{type:"submit",disabled:Z.value||ae.value,class:"btn btn-primary mt-4 disabled:opacity-50 disabled:cursor-not-allowed"},[Z.value?(n(),r("span",D,"Salvando...")):(n(),r("span",B,u(Y.value?"Atualizar Produto":"Salvar Produto"),1))],8,S)],32),a[19]||(a[19]=i("h2",{class:"text-xl font-semibold mb-2"},"Produtos Cadastrados",-1)),i("table",L,[a[17]||(a[17]=i("thead",null,[i("tr",null,[i("th",{class:"p-2"},"Imagem"),i("th",{class:"p-2"},"Nome"),i("th",{class:"p-2"},"Preço"),i("th",{class:"p-2"},"Ações")])],-1)),i("tbody",null,[(n(!0),r(g,null,v(Q.value,e=>{var a;return n(),r("tr",{key:e.id},[i("td",V,[e.images&&e.images.length?(n(),r("img",{key:0,src:(null==(a=e.images)?void 0:a[0])||"/placeholder-image.png",class:"w-16 h-16 object-cover rounded",alt:e.name,onError:le},null,40,F)):(n(),r("div",N," Sem imagem "))]),i("td",M,u(e.name),1),i("td",$," R$ "+u((parseFloat(e.price)||0).toFixed(2)),1),i("td",T,[i("button",{class:"btn btn-xs btn-warning mr-2",onClick:a=>function(e){Y.value=e.id,X.value={name:e.name||"",price:parseFloat(e.price)||0,description:e.description||"",category_id:e.category_id||"",stock_quantity:e.stock_quantity||10,images:(e.images||[]).map(e=>({url:e,preview:e,status:"success"}))}}(e)}," Editar ",8,G),i("button",{class:"btn btn-xs btn-danger",onClick:a=>async function(e){if(confirm("Tem certeza que deseja excluir este produto?"))try{await w.deleteProduct(e),J("Produto excluído com sucesso!","success"),await oe()}catch(a){console.error("Erro ao excluir produto:",a),J("Erro ao excluir produto","error")}}(e.id)}," Excluir ",8,O)])])}),128))])])]))}},[["__scopeId","data-v-e77ec4b3"]]);export{H as default};
