import{_ as e,r as a,o,c as s,a as l,b as t,t as r,w as c,v as u,F as n,e as i,h as d,p as m,u as p,d as v}from"./index-BgbrXe1X.js";const b={class:"admin-products-page p-8"},g={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},f={class:"md:col-span-2"},h={class:"md:col-span-2"},w={class:"flex mt-2 space-x-2"},y=["src"],x={class:"w-full bg-white rounded shadow"},P={class:"p-2"},k=["src"],E={class:"p-2"},_={class:"p-2"},C={class:"p-2"},j=["onClick"],A=["onClick"],F=e({__name:"AdminProducts",setup(e){const{showNotification:F}=p(),U=a([]),q=a({name:"",price:0,description:"",images:[]}),I=a([]),N=a(null);async function R(){try{console.log("Buscando produtos...");const e=await m.getProducts();console.log("Produtos recebidos:",e),U.value=e.data||e}catch(e){console.error("Erro ao buscar produtos:",e),F("Erro ao carregar produtos","error")}}function S(e){const a=Array.from(e.target.files);q.value.images=a,I.value=a.map(e=>URL.createObjectURL(e))}async function V(){try{let e=[];if(q.value.images&&q.value.images.length>0&&q.value.images[0]instanceof File)for(const o of q.value.images){const a=await m.uploadImage(o);a&&a.data&&a.data.url&&e.push(a.data.url)}else I.value&&I.value.length>0&&(e=I.value);const a={name:q.value.name,price:parseFloat(q.value.price)||0,description:q.value.description,images:JSON.stringify(e),category_id:1,stock_quantity:10,is_active:!0};N.value?(await m.updateProduct(N.value,a),F("Produto atualizado com sucesso!","success"),N.value=null):(await m.createProduct(a),F("Produto criado com sucesso!","success")),await R(),q.value={name:"",price:0,description:"",images:[]},I.value=[]}catch(e){console.error("Erro ao salvar produto:",e),F("Erro ao salvar produto","error")}}return o(()=>{console.log("AdminProducts mounted"),R()}),(e,a)=>(l(),s("div",b,[a[9]||(a[9]=t("h1",{class:"text-2xl font-bold mb-6"},"Administração de Produtos",-1)),t("p",null,"Debug: Componente carregado. Produtos: "+r(U.value.length),1),t("form",{onSubmit:d(V,["prevent"]),class:"mb-8 bg-white p-6 rounded shadow"},[t("div",g,[t("div",null,[a[3]||(a[3]=t("label",{class:"block font-semibold mb-1"},"Nome do Produto",-1)),c(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>q.value.name=e),class:"input",required:""},null,512),[[u,q.value.name]])]),t("div",null,[a[4]||(a[4]=t("label",{class:"block font-semibold mb-1"},"Preço (R$)",-1)),c(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>q.value.price=e),type:"number",min:"0",step:"0.01",class:"input",required:""},null,512),[[u,q.value.price,void 0,{number:!0}]])]),t("div",f,[a[5]||(a[5]=t("label",{class:"block font-semibold mb-1"},"Descrição",-1)),c(t("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>q.value.description=e),class:"input",rows:"2"},null,512),[[u,q.value.description]])]),t("div",h,[a[6]||(a[6]=t("label",{class:"block font-semibold mb-1"},"Imagens",-1)),t("input",{type:"file",multiple:"",onChange:S},null,32),t("div",w,[(l(!0),s(n,null,i(I.value,(e,a)=>(l(),s("img",{key:a,src:e,class:"w-20 h-20 object-cover rounded border"},null,8,y))),128))])])]),a[7]||(a[7]=t("button",{type:"submit",class:"btn btn-primary mt-4"}," Salvar Produto ",-1))],32),a[10]||(a[10]=t("h2",{class:"text-xl font-semibold mb-2"},"Produtos Cadastrados",-1)),t("table",x,[a[8]||(a[8]=t("thead",null,[t("tr",null,[t("th",{class:"p-2"},"Imagem"),t("th",{class:"p-2"},"Nome"),t("th",{class:"p-2"},"Preço"),t("th",{class:"p-2"},"Ações")])],-1)),t("tbody",null,[(l(!0),s(n,null,i(U.value,e=>{var a;return l(),s("tr",{key:e.id},[t("td",P,[e.images&&e.images.length?(l(),s("img",{key:0,src:null==(a=e.images)?void 0:a[0],class:"w-16 h-16 object-cover rounded"},null,8,k)):v("",!0)]),t("td",E,r(e.name),1),t("td",_," R$ "+r((parseFloat(e.price)||0).toFixed(2)),1),t("td",C,[t("button",{class:"btn btn-xs btn-warning mr-2",onClick:a=>function(e){N.value=e.id,q.value={...e,images:[]},I.value=e.images||[]}(e)}," Editar ",8,j),t("button",{class:"btn btn-xs btn-danger",onClick:a=>async function(e){if(confirm("Tem certeza que deseja excluir este produto?"))try{await m.deleteProduct(e),F("Produto excluído com sucesso!","success"),await R()}catch(a){console.error("Erro ao excluir produto:",a),F("Erro ao excluir produto","error")}}(e.id)}," Excluir ",8,A)])])}),128))])])]))}},[["__scopeId","data-v-588fe94d"]]);export{F as default};
