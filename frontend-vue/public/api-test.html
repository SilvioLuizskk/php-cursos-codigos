<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de Integra√ß√£o - EstampariaPro</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .section-title {
        color: #333;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }
      .btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #0056b3;
      }
      .btn-success {
        background: #28a745;
      }
      .btn-danger {
        background: #dc3545;
      }
      .btn-warning {
        background: #ffc107;
        color: #212529;
      }
      .response {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin-top: 10px;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
      }
      .success {
        border-color: #28a745;
        background: #d1e7dd;
      }
      .error {
        border-color: #dc3545;
        background: #f8d7da;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      .form-group input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }
      .status-success {
        background: #d1e7dd;
        color: #0f5132;
      }
      .status-error {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <h1>üß™ EstampariaPro - Teste de Integra√ß√£o API</h1>
    <p>
      <strong>Backend:</strong> http://localhost:8001/api |
      <strong>Status:</strong>
      <span id="server-status" class="status">Verificando...</span>
    </p>

    <!-- ========== AUTENTICA√á√ÉO ========== -->
    <div class="container">
      <h2 class="section-title">üîê Autentica√ß√£o</h2>

      <div class="form-group">
        <label>Email:</label>
        <input
          type="email"
          id="auth-email"
          value="teste@exemplo.com"
          placeholder="Digite seu email"
        />
      </div>

      <div class="form-group">
        <label>Senha:</label>
        <input
          type="password"
          id="auth-password"
          value="SenhaForte123@"
          placeholder="Digite sua senha"
        />
      </div>

      <div class="form-group">
        <label>Nome (para registro):</label>
        <input
          type="text"
          id="auth-name"
          value="Jo√£o Silva"
          placeholder="Digite seu nome"
        />
      </div>

      <button class="btn btn-success" onclick="testRegister()">
        Registrar
      </button>
      <button class="btn" onclick="testLogin()">Login</button>
      <button class="btn btn-warning" onclick="testLogout()">Logout</button>
      <button class="btn" onclick="testGetUser()">Obter Usu√°rio</button>
      <button class="btn" onclick="testRefreshToken()">Renovar Token</button>

      <div id="auth-response" class="response"></div>
    </div>

    <!-- ========== PRODUTOS ========== -->
    <div class="container">
      <h2 class="section-title">üõçÔ∏è Produtos</h2>

      <button class="btn" onclick="testGetProducts()">Listar Produtos</button>
      <button class="btn" onclick="testGetFeaturedProducts()">
        Produtos em Destaque
      </button>
      <button class="btn" onclick="testSearchProducts()">
        Buscar Produtos
      </button>
      <button class="btn" onclick="testGetProduct(1)">
        Detalhes Produto #1
      </button>

      <div id="products-response" class="response"></div>
    </div>

    <!-- ========== CARRINHO ========== -->
    <div class="container">
      <h2 class="section-title">üõí Carrinho</h2>

      <button class="btn" onclick="testGetCart()">Ver Carrinho</button>
      <button class="btn" onclick="testGetCartCount()">
        Contagem do Carrinho
      </button>
      <button class="btn btn-success" onclick="testAddToCart()">
        Adicionar ao Carrinho
      </button>
      <button class="btn btn-warning" onclick="testUpdateCart()">
        Atualizar Carrinho
      </button>
      <button class="btn btn-danger" onclick="testRemoveFromCart()">
        Remover do Carrinho
      </button>
      <button class="btn btn-danger" onclick="testClearCart()">
        Limpar Carrinho
      </button>

      <div id="cart-response" class="response"></div>
    </div>

    <!-- ========== PEDIDOS ========== -->
    <div class="container">
      <h2 class="section-title">üì¶ Pedidos</h2>

      <button class="btn" onclick="testGetOrders()">Listar Pedidos</button>
      <button class="btn" onclick="testGetOrderStats()">Estat√≠sticas</button>
      <button class="btn btn-success" onclick="testCreateOrder()">
        Criar Pedido
      </button>
      <button class="btn" onclick="testGetOrder(1)">Detalhes Pedido #1</button>

      <div id="orders-response" class="response"></div>
    </div>

    <script>
      // Configura√ß√£o do Axios
      const API_BASE_URL = "http://localhost:8001/api";
      let authToken = localStorage.getItem("auth_token");

      // Configurar interceptadores
      axios.defaults.baseURL = API_BASE_URL;
      axios.defaults.headers.common["Accept"] = "application/json";
      axios.defaults.headers.common["Content-Type"] = "application/json";

      // Adicionar token se existir
      if (authToken) {
        axios.defaults.headers.common["Authorization"] = `Bearer ${authToken}`;
      }

      // Interceptador de resposta
      axios.interceptors.response.use(
        (response) => response,
        (error) => {
          console.error("API Error:", error.response || error);
          return Promise.reject(error);
        }
      );

      // Verificar status do servidor
      async function checkServerStatus() {
        try {
          await axios.get("/health");
          document.getElementById("server-status").className =
            "status status-success";
          document.getElementById("server-status").textContent = "Online";
        } catch (error) {
          document.getElementById("server-status").className =
            "status status-error";
          document.getElementById("server-status").textContent = "Offline";
        }
      }

      // Fun√ß√£o para exibir resposta
      function displayResponse(elementId, response, isError = false) {
        const element = document.getElementById(elementId);
        element.className = `response ${isError ? "error" : "success"}`;
        element.textContent = JSON.stringify(response, null, 2);
      }

      // ========== TESTES DE AUTENTICA√á√ÉO ==========
      async function testRegister() {
        try {
          const response = await axios.post("/auth/register", {
            name: document.getElementById("auth-name").value,
            email: document.getElementById("auth-email").value,
            password: document.getElementById("auth-password").value,
            password_confirmation:
              document.getElementById("auth-password").value,
          });

          if (response.data.token) {
            authToken = response.data.token;
            localStorage.setItem("auth_token", authToken);
            axios.defaults.headers.common[
              "Authorization"
            ] = `Bearer ${authToken}`;
            localStorage.setItem(
              "auth_user",
              JSON.stringify(response.data.user)
            );
          }

          displayResponse("auth-response", response.data);
        } catch (error) {
          displayResponse(
            "auth-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testLogin() {
        try {
          const response = await axios.post("/auth/login", {
            email: document.getElementById("auth-email").value,
            password: document.getElementById("auth-password").value,
          });

          if (response.data.token) {
            authToken = response.data.token;
            localStorage.setItem("auth_token", authToken);
            axios.defaults.headers.common[
              "Authorization"
            ] = `Bearer ${authToken}`;
            localStorage.setItem(
              "auth_user",
              JSON.stringify(response.data.user)
            );
          }

          displayResponse("auth-response", response.data);
        } catch (error) {
          displayResponse(
            "auth-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testLogout() {
        try {
          const response = await axios.post("/auth/logout");

          authToken = null;
          localStorage.removeItem("auth_token");
          localStorage.removeItem("auth_user");
          delete axios.defaults.headers.common["Authorization"];

          displayResponse("auth-response", response.data);
        } catch (error) {
          displayResponse(
            "auth-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testGetUser() {
        try {
          const response = await axios.get("/auth/user");
          displayResponse("auth-response", response.data);
        } catch (error) {
          displayResponse(
            "auth-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testRefreshToken() {
        try {
          const response = await axios.post("/auth/refresh");

          if (response.data.token) {
            authToken = response.data.token;
            localStorage.setItem("auth_token", authToken);
            axios.defaults.headers.common[
              "Authorization"
            ] = `Bearer ${authToken}`;
          }

          displayResponse("auth-response", response.data);
        } catch (error) {
          displayResponse(
            "auth-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      // ========== TESTES DE PRODUTOS ==========
      async function testGetProducts() {
        try {
          const response = await axios.get("/products", {
            params: {
              page: 1,
              per_page: 10,
              sort_by: "created_at",
              sort_order: "desc",
            },
          });
          displayResponse("products-response", response.data);
        } catch (error) {
          displayResponse(
            "products-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testGetFeaturedProducts() {
        try {
          const response = await axios.get("/products/featured");
          displayResponse("products-response", response.data);
        } catch (error) {
          displayResponse(
            "products-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testSearchProducts() {
        try {
          const response = await axios.get("/products/search", {
            params: { q: "chinelo" },
          });
          displayResponse("products-response", response.data);
        } catch (error) {
          displayResponse(
            "products-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testGetProduct(id) {
        try {
          const response = await axios.get(`/products/${id}`);
          displayResponse("products-response", response.data);
        } catch (error) {
          displayResponse(
            "products-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      // ========== TESTES DE CARRINHO ==========
      async function testGetCart() {
        try {
          const response = await axios.get("/cart");
          displayResponse("cart-response", response.data);
        } catch (error) {
          displayResponse(
            "cart-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testGetCartCount() {
        try {
          const response = await axios.get("/cart/count");
          displayResponse("cart-response", response.data);
        } catch (error) {
          displayResponse(
            "cart-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testAddToCart() {
        try {
          const response = await axios.post("/cart/add", {
            product_id: 1,
            quantity: 2,
            customization: {
              size: "M",
              color: "Azul",
            },
          });
          displayResponse("cart-response", response.data);
        } catch (error) {
          displayResponse(
            "cart-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testUpdateCart() {
        try {
          const response = await axios.put("/cart/1", {
            quantity: 3,
          });
          displayResponse("cart-response", response.data);
        } catch (error) {
          displayResponse(
            "cart-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testRemoveFromCart() {
        try {
          const response = await axios.delete("/cart/1");
          displayResponse("cart-response", response.data);
        } catch (error) {
          displayResponse(
            "cart-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testClearCart() {
        try {
          const response = await axios.delete("/cart");
          displayResponse("cart-response", response.data);
        } catch (error) {
          displayResponse(
            "cart-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      // ========== TESTES DE PEDIDOS ==========
      async function testGetOrders() {
        try {
          const response = await axios.get("/orders");
          displayResponse("orders-response", response.data);
        } catch (error) {
          displayResponse(
            "orders-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testGetOrderStats() {
        try {
          const response = await axios.get("/orders/stats");
          displayResponse("orders-response", response.data);
        } catch (error) {
          displayResponse(
            "orders-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testCreateOrder() {
        try {
          const response = await axios.post("/orders", {
            shipping_address: {
              street: "Rua das Flores, 123",
              number: "123",
              city: "S√£o Paulo",
              state: "SP",
              zip_code: "01234-567",
            },
            payment_method: "credit_card",
            notes: "Entrega r√°pida por favor",
          });
          displayResponse("orders-response", response.data);
        } catch (error) {
          displayResponse(
            "orders-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      async function testGetOrder(id) {
        try {
          const response = await axios.get(`/orders/${id}`);
          displayResponse("orders-response", response.data);
        } catch (error) {
          displayResponse(
            "orders-response",
            error.response?.data || error.message,
            true
          );
        }
      }

      // Verificar status do servidor ao carregar
      checkServerStatus();

      // Verificar se h√° token salvo
      if (authToken) {
        document.getElementById("auth-response").textContent =
          "Token encontrado no localStorage: " +
          authToken.substring(0, 50) +
          "...";
      }
    </script>
  </body>
</html>
